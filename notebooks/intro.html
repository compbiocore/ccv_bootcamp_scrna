<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Introduction</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="intro_files/libs/clipboard/clipboard.min.js"></script>
<script src="intro_files/libs/quarto-html/quarto.js"></script>
<script src="intro_files/libs/quarto-html/popper.min.js"></script>
<script src="intro_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="intro_files/libs/quarto-html/anchor.min.js"></script>
<link href="intro_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="intro_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="intro_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="intro_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="intro_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Introduction</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="to-use-this-notebook" class="level2">
<h2 class="anchored" data-anchor-id="to-use-this-notebook">To use this notebook</h2>
<ol type="1">
<li>Go to ood.ccv.brown.edu (you will need an Oscar account).</li>
<li>Go to ‘Clusters’ in the blue menu bar at the top and click the drop-down that says ‘&gt;_OSCAR Shell Access’</li>
<li>Go to your home folder and make a folder called <code>scrna_r_workshop_2023</code> (<code>cd ~</code> and <code>mkdir scrna_r_workshop_2023</code>), then type <code>pwd</code> to get the path to this folder.</li>
<li>Look under <code>Interactive Apps</code> in the blue menu bar and click on <code>RStudio on Singularity</code> under <code>Expert GUIs</code>.</li>
</ol>
<p>Fill in the fields as follows:</p>
<ul>
<li><code>Account</code>: leave blank<br>
</li>
<li><code>Partition</code>: leave blank<br>
</li>
<li><code>Number of hours</code>: 3<br>
</li>
<li><code>Num Cores</code>: 8<br>
</li>
<li><code>Memory</code>: 90<br>
</li>
<li><code>Singularity Container Path</code>:/gpfs/data/shared/databases/workshops/bootcamp_2023/scrna_r_workshop.sif<br>
</li>
<li><code>Package install Path</code>: leave blank<br>
</li>
<li><code>Path for R Executable</code>: This should be the full path to the <code>scrna_r_workshop_2023</code> you made in step 3.<br>
</li>
<li><code>R Module</code>: leave blank<br>
</li>
<li><code>Additional Data Path</code>: /gpfs/data/shared/databases/workshops/bootcamp_2023/scrna_r_workshop<br>
</li>
</ul>
<p>Once your job starts, click the button to connect to session.<br>
At the top of the screen you’ll see a menu bar that starts with ‘file’, click on ‘file’ and ‘open file’.<br>
It will ask for a File name – paste this into the box: <code>/gpfs/data/shared/databases/workshops/bootcamp_2023/scrna_r_workshop/intro.Rmd</code></p>
</section>
<section id="introduction-to-scrna-seq" class="level2">
<h2 class="anchored" data-anchor-id="introduction-to-scrna-seq">Introduction to scRNA-seq</h2>
<p><strong>What we will cover</strong><br>
- How does scRNA-seq differ from bulk RNA-seq?<br>
- scRNAseq technologies<br>
- Parallelization options for Seurat and other packages<br>
- Seurat objects and importing data<br>
- Data merging, QC, and filtering<br>
- SCTransform normalization, clustering, dimension reduction<br>
- Data integration&nbsp; - Differential expression testing<br>
- Data visualization<br>
- Classifying cell types with a reference atlas with TransferAnchors from Seurat<br>
</p>
<p>Much of this notebook is adapted from the Seurat vignettes https://satijalab.org/seurat and GitHub repository https://github.com/satijalab/seurat</p>
</section>
<section id="how-does-scrna-seq-differ-from-bulk-rna-seq" class="level2">
<h2 class="anchored" data-anchor-id="how-does-scrna-seq-differ-from-bulk-rna-seq">How does scRNA-seq differ from bulk RNA-seq?</h2>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="image/bulk_vs_singlecell.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">bulk vs single cell</figcaption>
</figure>
</div>
<ul>
<li><p>In bulk RNA-seq you are taking a snapshot of expression of all the cells in a sample and your measurements are aggregated across all of those cells.</p></li>
<li><p>In scRNA-seq, you can get a sense of the heterogeneity of the cells in your sample.</p>
<ul>
<li><p>Are there novel or rare cell types?</p></li>
<li><p>What about cell type specific gene expression?</p></li>
<li><p>Does the distribution of different cell types change across time or treatment?</p></li>
</ul></li>
<li><p>This increased resolution comes with some unique challenges.</p>
<ul>
<li><p>Dropouts - genes that are not detected in some cells, can lead to sparse expression matrices with many zero values.</p></li>
<li><p>Doublets - sequencing two cells at the same time and can’t distinguish their expression or cell types, need to filter these out during QC.</p></li>
<li><p>Dying cells - you will lose some cells because they are dead or dying, you can also filter these out during sample QC.</p></li>
<li><p>You also should be cautious when thinking about your sample sizes. For example, you may be sequencing thousands of cells but if they all come from the same mouse you lose the ability to generalize your findings.</p></li>
</ul></li>
</ul>
</section>
<section id="scrnaseq-technologies" class="level2">
<h2 class="anchored" data-anchor-id="scrnaseq-technologies">scRNAseq technologies</h2>
<ul>
<li>Although 10X genomics is probably the most popular technology for scRNA-seq, there are other flavors as well (see PMID 30472192 and PMID 28212749).</li>
</ul>
<p><img src="image/10x_flow.png" class="img-fluid"></p>
<p>10x sequencing encapsulates a cell, reagents, and a bead w/ primer in an oil droplet (aka GEM or Gel Bead-in EMulsion). Again, if you have a situation where one droplet has two cells, this is a ‘doublet’, you can also have empty droplets where there’s no cell encapsulated.</p>
<p><img src="image/10x_bead.png" class="img-fluid"></p>
<p>After encapsulation of cells, beads, and reagents in the oil droplets, the bead is dissolved and releases primers. The poly (dT) primers are used for generating the gene expression libraries. The capture sequence primers are shown in a lighter shading because they are only used in situations where you’d like to add an extra channel of information to your experiment by using feature barcoding (cell-surface protein characterization, multiplexing, etc.).</p>
</section>
<section id="library-preparation-details" class="level2">
<h2 class="anchored" data-anchor-id="library-preparation-details">Library preparation details</h2>
<p>Let’s go over the details of how the library prep works (see https://teichlab.github.io/scg_lib_structs/methods_html/10xChromium3.html)</p>
<p><img src="image/seq_step1.png" class="img-fluid" alt="sc bead">The polyA mRNAs are captured using the oligo(dT) on the beads, MMLV (Moloney Murine Leukemia Virus) reverse transcriptase synthesizes complementary strand to the fragment thats captured.\\</p>
<p><img src="image/seq_step2.png" class="img-fluid"></p>
<p>The RT adds some extra Cs on the end.\\</p>
<p><img src="image/seq_step3.png" class="img-fluid"></p>
<p>The template-switching oligo is added so we can continue across the other strand.\\</p>
<p><img src="image/seq_step4.png" class="img-fluid" alt="sc bead"> Add primers to amplify full length cDNA\\</p>
<p><img src="image/seq_step5.png" class="img-fluid" alt="sc bead"> Fragment cDNA, perform A-tailing\\</p>
<p><img src="image/seq_step6.png" class="img-fluid" alt="sc bead"> At this point we add the Truseq adapters, product 3 is what you’ll actually sequence.\\</p>
<p><img src="image/seq_step7.png" class="img-fluid"></p>
<p>Add the library PCR primers 1 and 2 to amplify the library\\</p>
<p><img src="image/seq_step8.png" class="img-fluid" alt="sc bead">The final library structure looks like the above image – the exact length of the UMI might depend on which chemistry you’re using.</p>
<p><img src="image/10x_lib_seq.png" class="img-fluid" alt="sc bead">The actual sequencing looks like the above image. Truseq Read 1 uses bottom strand as template and sequences the bacrode + UMI. Sample Index primer sequences the sample index using bottom strand as template. Regenerate clusters and Truseq Read 2 primer sequences the second read using the top strand as template.\\</p>
<p><img src="image/single_vs_double.png" class="img-fluid"></p>
<p>The above steps assume a single index library, if you’re using dual indexes there will be another sample index between the P5 and Truseq Read 1. Dual indexed libraries are beneficial to help prevent index hopping (https://www.10xgenomics.com/blog/sequence-with-confidence-understand-index-hopping-and-how-to-resolve-it).\\</p>
<pre><code>::: {.callout-tip}
## Tip 
https://teichlab.github.io/scg_lib_structs/ is an excellent resource for information about the resulting library structures for 10x libraries (and other single cell technologies like Drop-seq or SMART-seq) and was our resource for most of this section.
:::</code></pre>
</section>
<section id="parallelization-options-for-seurat-and-other-packages" class="level2">
<h2 class="anchored" data-anchor-id="parallelization-options-for-seurat-and-other-packages">Parallelization options for Seurat and other packages</h2>
<p>Let’s get started. First, we can set the <code>.libPaths()</code>, which essentially tells R that it should look for packages inside these locations inside the Singularity container.</p>
<div class="cell" data-hash="intro_cache/html/set lib paths_76f48d82aea5cd3086c869d5a515eb0f">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">.libPaths</span>(<span class="fu">c</span>(<span class="st">'/usr/local/lib/R/site-library'</span>, <span class="st">'/usr/local/lib/R/library'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>All of the methods we are discussing here involve computationally heavy methods, and as such also take advantage of parallelization where they can. Often in their documentation you will find how to use multiple cores when calling a function, usually involving a provided argument or involving a package called <code>future</code>.</p>
<p>For example, Seurat has a <a href="https://satijalab.org/seurat/archive/v4.3/future_vignette">vignette on parallelization</a> with <code>future</code>. We will follow it here:</p>
<div class="cell" data-hash="intro_cache/html/unnamed-chunk-1_9ded60e489edb3b3b58e0759d5836852">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(future)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># check the current active plan</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plan</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>sequential:
- args: function (..., envir = parent.frame())
- tweaked: FALSE
- call: NULL</code></pre>
</div>
</div>
<p><code>plan()</code> says that we are currently set up to run code <em>sequentially</em> or non-parallelized. To see more information, run this code chunk:</p>
<div class="cell" data-hash="intro_cache/html/unnamed-chunk-2_37f64c9e1eef586d3eb97545cca2fd00">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>?future<span class="sc">::</span>plan</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now, we set workers=8 because we’ve requested 8 cores. Additionally, we set <code>multisession</code> instead of <code>multiprocess</code> despite what the vignette says, because <code>multiprocess</code> is actually deprecated in <code>future</code> and we should be explicitly specifying <code>multisession</code> or <code>multicore</code> instead. Getting into the difference is out of scope of this workshop, but you can <a href="https://cran.r-project.org/web/packages/future/vignettes/future-1-overview.html">read more</a> on future yourself if interested.</p>
<div class="cell" data-hash="intro_cache/html/unnamed-chunk-3_eeac7ba95acc0de3cc4e3b199d3882e2">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># change the current plan to access parallelization</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plan</span>(<span class="st">"multisession"</span>, <span class="at">workers =</span> <span class="dv">8</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plan</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>multisession:
- args: function (..., workers = 8, envir = parent.frame())
- tweaked: TRUE
- call: plan("multisession", workers = 8)</code></pre>
</div>
</div>
<p>We’ll also set a seed at the start of the notebook so that we can reproduce our results if we decide to re-run this notebook at some future date. We also set <code>future.globals.maxSize</code>, see the Seurat future vignette linked above for discussion about why we do this (basically we might be exceeding the allowed global variable size so we make that default bigger).</p>
<div class="cell" data-hash="intro_cache/html/unnamed-chunk-4_6e378ad7c70c3cb169ea7a7b166ef33d">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">61</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">future.globals.maxSize =</span> <span class="dv">4000</span> <span class="sc">*</span> <span class="dv">1024</span><span class="sc">^</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>